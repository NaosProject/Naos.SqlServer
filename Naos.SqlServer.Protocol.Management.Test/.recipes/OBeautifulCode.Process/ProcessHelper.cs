// --------------------------------------------------------------------------------------------------------------------
// <copyright file="ProcessHelper.cs" company="OBeautifulCode">
//   Copyright (c) OBeautifulCode 2018. All rights reserved.
// </copyright>
// <auto-generated>
//   Sourced from NuGet package. Will be overwritten with package update except in OBeautifulCode.Process.Recipes source.
// </auto-generated>
// --------------------------------------------------------------------------------------------------------------------

namespace OBeautifulCode.Process.Recipes
{
    using global::System;
    using global::System.Diagnostics;
    using global::System.Security.Principal;

    using DotNetProcess = global::System.Diagnostics.Process;

    using static global::System.FormattableString;

    /// <summary>
    /// Contains helper/convenience methods related to managing processes.
    /// </summary>
#if !OBeautifulCodeProcessSolution
    [global::System.Diagnostics.CodeAnalysis.ExcludeFromCodeCoverage]
    [global::System.CodeDom.Compiler.GeneratedCode("OBeautifulCode.Process.Recipes", "See package version number")]
    internal
#else
    public
#endif
    static class ProcessHelper
    {
        /// <summary>
        /// Gets a value indicating whether or not the executing process is running as administrator.
        /// </summary>
        /// <remarks>I'm not certain if this works on a thread that is impersonating or not.</remarks>
        /// <returns>Value indicating whether or not the executing process is running as administrator.</returns>
        [System.Diagnostics.CodeAnalysis.SuppressMessage("Microsoft.Performance", "CA1811:AvoidUncalledPrivateCode", Justification = "The caller will be the consumer of this recipe.")]
        public static bool IsCurrentlyRunningAsAdmin()
        {
            var result = WindowsIdentity.GetCurrent().Owner?.IsWellKnown(WellKnownSidType.BuiltinAdministratorsSid) ?? false;
            return result;
        }

        /// <summary>
        /// Gets the currently running process.
        /// </summary>
        /// <returns>
        /// The currently running process.
        /// </returns>
        [System.Diagnostics.CodeAnalysis.SuppressMessage("Microsoft.Design", "CA1024:UsePropertiesWhereAppropriate", Justification = "Don't want to use a property for this kind of active call.")]
        [System.Diagnostics.CodeAnalysis.SuppressMessage("Microsoft.Performance", "CA1811:AvoidUncalledPrivateCode", Justification = "The caller will be the consumer of this recipe.")]
        public static DotNetProcess GetRunningProcess()
        {
            var result = DotNetProcess.GetCurrentProcess();
            return result;
        }

        /// <summary>
        /// Gets the process' name.
        /// </summary>
        /// <param name="process">The process</param>
        /// <returns>
        /// The process' name.
        /// </returns>
        [System.Diagnostics.CodeAnalysis.SuppressMessage("Microsoft.Performance", "CA1811:AvoidUncalledPrivateCode", Justification = "The caller will be the consumer of this recipe.")]
        public static string GetName(
            this DotNetProcess process)
        {
            if (process == null)
            {
                throw new ArgumentNullException(nameof(process));
            }

            var result = process.ProcessName;
            return result;
        }

        /// <summary>
        /// Gets the file path of a process.
        /// </summary>
        /// <param name="process">The process</param>
        /// <returns>
        /// The file path of the a process.
        /// </returns>
        [System.Diagnostics.CodeAnalysis.SuppressMessage("Microsoft.Performance", "CA1811:AvoidUncalledPrivateCode", Justification = "The caller will be the consumer of this recipe.")]
        public static string GetFilePath(
            this DotNetProcess process)
        {
            if (process == null)
            {
                throw new ArgumentNullException(nameof(process));
            }

            var result = process.GetProcessMainModule().FileName;
            return result;
        }

        /// <summary>
        /// Gets the file version of a process.
        /// </summary>
        /// <param name="process">The process</param>
        /// <returns>
        /// The file version of a process.
        /// </returns>
        [System.Diagnostics.CodeAnalysis.SuppressMessage("Microsoft.Performance", "CA1811:AvoidUncalledPrivateCode", Justification = "The caller will be the consumer of this recipe.")]
        public static string GetFileVersion(
            this DotNetProcess process)
        {
            if (process == null)
            {
                throw new ArgumentNullException(nameof(process));
            }

            var result = process.GetProcessMainModule().FileVersionInfo.FileVersion;
            return result;
        }

        /// <summary>
        /// Gets the product version of a process.
        /// </summary>
        /// <param name="process">The process</param>
        /// <returns>
        /// The product version of a process.
        /// </returns>
        [System.Diagnostics.CodeAnalysis.SuppressMessage("Microsoft.Performance", "CA1811:AvoidUncalledPrivateCode", Justification = "The caller will be the consumer of this recipe.")]
        public static string GetProductVersion(
            this DotNetProcess process)
        {
            if (process == null)
            {
                throw new ArgumentNullException(nameof(process));
            }

            var result = process.GetProcessMainModule().FileVersionInfo.ProductVersion;
            return result;
        }

        private static ProcessModule GetProcessMainModule(
            this DotNetProcess process)
        {
            if (process == null)
            {
                throw new ArgumentNullException(nameof(process));
            }

            var result = process.MainModule;

            if (result == null)
            {
                throw new ArgumentNullException(Invariant($"{nameof(process)}.{nameof(result)}"));
            }

            return result;
        }
    }
}